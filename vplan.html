<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vplan</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /*gowtham*/
    /* ===== THEME VARIABLES ===== */
    :root {
        --bg: #0f1113; --card: #16181a; 
        --gold: #d4b55a; --gold-dim: rgba(212,181,90,0.15);
        --muted: #9ca3af; 
        --success: #66bb6a; --danger: #ef5350; --info: #29b6f6;
        --border: rgba(255,255,255,0.08);
        --shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    
    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }

    body {
        margin: 0; font-family: 'Segoe UI', system-ui, sans-serif;
        background: linear-gradient(180deg, #0b0c0d, #0f1113);
        color: #eee; overflow-x: hidden; min-height: 100vh;
    }

    .wrap { max-width: 1350px; margin: 0 auto; padding: 20px; }

    /* ===== LAYOUT ===== */
    header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; }
    .logo { background: linear-gradient(90deg, var(--gold), #f0d27a); -webkit-background-clip: text; color: transparent; font-weight: 800; font-size: 32px; letter-spacing: -1px; }
    .tag { color: var(--muted); font-size: 14px; }

    /* 3-Column Grid */
    main {
        display: grid; grid-template-columns: 320px 1fr 300px; 
        gap: 25px; align-items: start;
    }

    /* ===== COMPONENTS ===== */
    .card {
        background: var(--card); border: 1px solid var(--border);
        padding: 20px; border-radius: 16px; box-shadow: var(--shadow);
        transition: transform 0.2s ease; margin-bottom: 20px; position: relative;
    }
    
    label { display: block; font-size: 11px; color: var(--muted); margin: 12px 0 6px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
    input, select {
        width: 100%; padding: 12px; border-radius: 8px;
        border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.3);
        color: #fff; font-size: 14px; transition: border 0.3s;
    }
    input:focus { border-color: var(--gold); outline: none; }

    .btn {
        display: inline-block; width: 100%; padding: 12px; border-radius: 10px;
        border: none; cursor: pointer; font-weight: 600; font-size: 14px;
        transition: 0.2s; position: relative; overflow: hidden;
    }
    .btn:active { transform: scale(0.98); }
    .btn.primary { background: var(--gold); color: #000; box-shadow: 0 4px 15px rgba(212,181,90,0.2); }
    .btn.primary:hover { background: #e6c665; }
    .btn.secondary { background: rgba(255,255,255,0.05); color: #ccc; }
    .btn.secondary:hover { background: rgba(255,255,255,0.1); color: #fff; }

    /* Hero & Map */
    .hero-container { position: relative; height: 280px; border-radius: 16px; overflow: hidden; border: 1px solid var(--border); }
    .map-frame { width: 100%; height: 100%; border: 0; filter: grayscale(0.3) contrast(1.1); opacity: 0.7; transition: 0.5s; }
    .hero-overlay {
        position: absolute; bottom: 0; left: 0; width: 100%;
        background: linear-gradient(0deg, #000, transparent);
        padding: 20px; display: flex; justify-content: space-between; align-items: flex-end;
    }

    /* Budget Bar */
    .budget-meter { height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; margin-top: 5px; overflow: hidden; }
    .budget-fill { height: 100%; background: var(--gold); width: 0%; transition: width 1s ease, background 0.3s; }
    
    /* Results Grid */
    .card-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px; }
    .deal { padding: 15px; border-radius: 12px; background: rgba(255,255,255,0.02); border: 1px solid var(--border); }
    .price { font-weight: 700; color: var(--gold); font-size: 18px; margin-top: 4px; }

    /* History List */
    .history-item { 
        padding: 10px; border-bottom: 1px solid var(--border); cursor: pointer; 
        transition: 0.2s; display: flex; justify-content: space-between; font-size: 13px;
    }
    .history-item:hover { background: rgba(255,255,255,0.05); }
    .history-item:last-child { border-bottom: none; }

    /* Optimization Column */
    .optimization-result { background: rgba(102, 187, 106, 0.1); border: 1px solid var(--success); border-radius: 16px; padding: 20px; color: #fff; }
    .opt-list li { margin-bottom: 12px; font-size: 13px; color: #ddd; list-style: none; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; }
    
    /* Itinerary */
    .itinerary { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
    .day { padding: 12px; border-radius: 10px; background: rgba(255,255,255,0.03); border-left: 3px solid var(--gold); display: flex; justify-content: space-between; align-items: center; }

    /* Toast Notification */
    #toast {
        visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center;
        border-radius: 8px; padding: 16px; position: fixed; z-index: 9999; left: 50%; bottom: 30px;
        transform: translateX(-50%); font-size: 14px; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        border-left: 4px solid var(--gold);
    }
    #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }

    /* Chat Bot & Animations */
    .ai-fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--gold); color: #000; font-size: 24px; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); cursor: pointer; transition: 0.3s; z-index: 100; }
    .ai-fab:hover { transform: scale(1.1); }
    .chat-window { position: fixed; bottom: 100px; right: 30px; width: 340px; height: 450px; background: #1a1a1a; border: 1px solid #333; border-radius: 16px; display: none; flex-direction: column; z-index: 100; box-shadow: 0 20px 60px rgba(0,0,0,0.9); overflow: hidden; }
    .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
    .msg { padding: 10px 14px; border-radius: 12px; font-size: 14px; max-width: 85%; }
    .msg.user { align-self: flex-end; background: #333; color: #fff; }
    .msg.ai { align-self: flex-start; background: var(--gold-dim); color: var(--gold); }
    
    @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
    @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
    .spinner { border: 3px solid rgba(255,255,255,0.1); border-left: 3px solid var(--gold); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-right: 8px; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    @media (max-width: 1100px) { main { grid-template-columns: 1fr; } .opt-column { width: 100%; } .card-grid { grid-template-columns: 1fr; } }
    
    @media print {
        body { background: #fff; color: #000; }
        header, aside, .btn, .ai-fab, .chat-window, .opt-column { display: none !important; }
        main { display: block; }
        .card { box-shadow: none; border: 1px solid #ddd; page-break-inside: avoid; }
        .hero-container { height: 150px; border: 1px solid #ddd; }
        .price { color: #000; }
    }
  </style>
</head>
<body>

  <div class="wrap">
    <header>
      <div class="logo-container">
        <div class="logo">Vplan</div>
        <div class="tag">AI Travel Suite</div>
      </div>
      <div>
        <button class="btn secondary" style="width:auto" onclick="UI.showToast('Login simulated')">Login</button>
      </div>
    </header>

    <main>
      <aside>
        <section class="card">
            <h3 style="margin-top:0">Trip Parameters</h3>
            <label>From (Origin)</label>
            <input id="origin" type="text" value="Hyderabad">
            <label>Destination</label>
            <input id="destination" type="text" value="Goa">
            
            <div style="display:flex;gap:10px;">
                <div style="flex:1"><label>Start</label><input id="start" type="date"></div>
                <div style="flex:1"><label>End</label><input id="end" type="date"></div>
            </div>
            
            <label>Travel Style</label>
            <select id="travelStyle">
                <option value="budget">üéí Budget Friendly (Hostels/Public Transport)</option>
                <option value="balanced" selected>‚öñÔ∏è Balanced (Standard Hotels/Cabs)</option>
                <option value="luxury">üíé Professional/Luxury (Resorts/Premium)</option>
            </select>

            <label>Interests</label>
            <input id="interests" type="text" placeholder="e.g. Beach, Hiking, Photography">

            <label>Budget (INR)</label>
            <input id="budget" type="number" value="20000" oninput="UI.updateBudgetBar()">
            <div class="budget-meter"><div id="budgetBar" class="budget-fill"></div></div>
            <div style="display:flex;justify-content:space-between;font-size:11px;margin-top:2px;color:var(--muted)"><span>0% Used</span><span id="budgetStatus">Safe</span></div>

            <div style="margin-top:20px;display:flex;gap:10px;">
                <button class="btn primary" id="planBtn"><span id="btnText">Generate Plan</span></button>
                <button class="btn secondary" style="width: auto;" id="clearBtn"><i class="fa-solid fa-rotate-right"></i></button>
            </div>
        </section>

        <section class="card">
            <h4 style="margin-top:0"><i class="fa-solid fa-clock-rotate-left"></i> Recent Plans</h4>
            <div id="historyList">
                <div style="font-size:13px; color:var(--muted); text-align:center">No history yet</div>
            </div>
        </section>

        <section class="card">
            <h4 style="margin-top:0"><i class="fa-solid fa-coins"></i> Converter</h4>
            <div style="display:flex; gap:10px; align-items:center;">
                <input type="number" id="inrAmount" placeholder="INR" oninput="UI.convertCurrency()">
                <select id="targetCurrency" style="width:80px" onchange="UI.convertCurrency()">
                    <option value="USD">USD</option><option value="EUR">EUR</option><option value="AED">AED</option>
                </select>
            </div>
            <div style="text-align:right; color:var(--gold); font-weight:bold; margin-top:5px;" id="conversionResult">0.00</div>
        </section>
      </aside>

      <section class="content">
        <div class="hero-container" id="heroMap">
            <iframe class="map-frame" id="mapFrame" src="about:blank"></iframe>
            <div class="hero-overlay">
                <div>
                    <h2 style="margin:0;color:var(--gold);font-size:28px;text-shadow: 0 2px 4px #000;" id="heroTitle">Ready?</h2>
                    <div style="color:#eee; margin-top:5px; text-shadow: 0 1px 2px #000;" id="heroSub">Enter details to begin</div>
                </div>
                <div id="weatherBadge" style="background:rgba(0,0,0,0.7); padding:8px 12px; border-radius:8px; display:none; align-items:center; gap:10px;">
                    <i class="fa-solid fa-cloud-sun" style="color:var(--gold)"></i>
                    <div style="text-align:right"><div id="wTemp" style="font-weight:bold">28¬∞C</div><div id="wDesc" style="font-size:11px">Sunny</div></div>
                </div>
            </div>
        </div>

        <div class="card" id="resultCard" style="display:none; animation: slideIn 0.5s;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h4 style="margin:0">Breakdown <span id="styleBadge" style="font-size:11px; background:rgba(255,255,255,0.1); padding:2px 6px; border-radius:4px; margin-left:5px;">Standard</span></h4>
                <button class="btn secondary" style="width:auto; font-size:12px; padding:6px 12px;" onclick="window.print()"><i class="fa-solid fa-print"></i> PDF</button>
            </div>
            <div class="card-grid" id="dealGrid"></div>
        </div>

        <div class="card" id="itineraryCard" style="display:none; animation: slideIn 0.6s;">
            <h4 style="margin-top:0">Itinerary</h4>
            <div class="itinerary" id="itineraryEl"></div>
        </div>

        <div class="card" id="packingCard" style="display:none; animation: slideIn 0.7s;">
            <h4 style="margin-top:0">Smart Packing</h4>
            <div class="packing-list" id="packingEl"></div>
        </div>
        
        <div class="card" id="chartCard" style="display:none; animation: slideIn 0.8s;">
            <h4 style="margin-top:0">Analytics</h4>
            <div style="height:180px; display:flex; justify-content:center;"><canvas id="pie"></canvas></div>
        </div>
      </section>

      <aside>
          <div id="optPlaceholder" class="card" style="text-align:center; color:var(--muted); padding:40px 20px;">
              <i class="fa-solid fa-wand-magic-sparkles" style="font-size:24px; margin-bottom:10px;"></i>
              <p>Generate a plan to see AI optimizations.</p>
          </div>
          <div id="optColumn" style="display:none; flex-direction:column; gap:20px; animation: slideIn 0.5s;">
              </div>
          <div style="margin-top:20px; text-align:center;">
             <button id="optimizeBtn" class="btn primary" style="display:none" onclick="UI.runOptimization()">Optimize Plan</button>
          </div>
      </aside>
    </main>

    <div class="ai-fab" id="aiFab"><i class="fa-solid fa-robot"></i></div>
    <div class="chat-window" id="chatWindow">
        <div style="padding:15px; background:var(--gold); color:#000; font-weight:bold; display:flex; justify-content:space-between; align-items:center;">
            <span>Vplan Assistant</span> <i class="fa-solid fa-xmark" style="cursor:pointer" id="closeChat"></i>
        </div>
        <div class="chat-body" id="chatBody"><div class="msg ai">Hello! I'm ready to help with your trip.</div></div>
        <div class="chat-footer">
            <input id="chatInput" type="text" placeholder="Type here..." style="border:none">
            <button class="btn primary" style="width:auto; padding:10px;" id="sendChat"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="toast">Notification</div>

  </div>

  <script>
    // ==========================================
    //  VIRTUAL BACKEND (Simulated API)
    // ==========================================
    const Backend = {
        generatePlan: async (data) => {
            await new Promise(r => setTimeout(r, 800)); // Delay
            const days = Math.max(1, Math.ceil((new Date(data.end) - new Date(data.start)) / (1000 * 3600 * 24)));
            const dist = data.origin.length * 100;
            
            // --- COST LOGIC BASED ON STYLE ---
            let flightBase = 2000;
            let hotelBase = 1500;
            let foodBase = 800;

            if(data.style === 'budget') {
                flightBase *= 0.8; hotelBase *= 0.6; foodBase *= 0.7; // Cheaper
            } else if (data.style === 'luxury') {
                flightBase *= 2.5; hotelBase *= 3.0; foodBase *= 2.0; // Expensive
            }

            const flightPrice = Math.max(2000, flightBase + dist - days*50 + Math.floor(Math.random()*1000));
            const hotelPrice = Math.max(800, hotelBase - days*20 + Math.floor(Math.random()*500));
            const foodCost = foodBase * days;
            const total = flightPrice + (hotelPrice * days) + foodCost;

            // --- ITINERARY & INTERESTS LOGIC ---
            const itinerary = [];
            const mainInterest = data.interests ? data.interests.split(',')[0] : 'Sightseeing';
            
            for(let i=1; i<=days; i++) {
                itinerary.push({ 
                    day: i, 
                    act1: i===1 ? `Depart from ${data.origin}` : `Explore ${data.dest} (${mainInterest} Spots)`, 
                    act2: i===1 ? `Check-in at ${data.style === 'budget' ? 'Hostel' : 'Hotel'}` : `Local Dining & Culture` 
                });
            }
            
            // --- PACKING LIST LOGIC ---
            let pack = ['ID', 'Charger', 'Cash', 'Clothes'];
            const ints = (data.interests || "").toLowerCase();
            
            if(ints.includes('beach') || data.dest.toLowerCase().includes('goa')) pack.push('Swimsuit', 'Sunscreen', 'Sunglasses');
            if(ints.includes('hike') || ints.includes('mountain')) pack.push('Hiking Boots', 'Backpack', 'Raincoat');
            if(ints.includes('photo')) pack.push('Camera', 'Tripod', 'Memory Cards');
            if(ints.includes('night') || ints.includes('party')) pack.push('Party Wear', 'Perfume');
            if(ints.includes('gym') || ints.includes('fitness')) pack.push('Workout Gear');
            
            if(data.style === 'budget') pack.push('Padlock', 'Quick-dry Towel');

            return { ...data, days, flightPrice, hotelPrice, foodCost, total, itinerary, pack, weather: {temp: 28, condition: 'Sunny'} };
        },
        optimize: async (total) => {
            await new Promise(r => setTimeout(r, 1000));
            return { tips: [ {t:"Shift Dates (+1 Day)", a:1200}, {t:"Smart Hotel Choice", a:800}, {t:"Public Transport", a:500} ], savings: 2500 };
        }
    };

    // ==========================================
    //  FRONTEND UI LOGIC
    // ==========================================
    const formatINR = n => '‚Çπ' + Math.round(n).toLocaleString('en-IN');
    let currentPlan = null;
    let chartInstance = null;

    const UI = {
        showToast: (msg) => {
            const x = document.getElementById("toast");
            x.innerText = msg; x.className = "show";
            setTimeout(() => x.className = x.className.replace("show", ""), 3000);
        },
        updateBudgetBar: () => {
            const budget = document.getElementById('budget').value;
            const total = currentPlan ? currentPlan.total : 0;
            const pct = Math.min(100, (total / budget) * 100);
            const bar = document.getElementById('budgetBar');
            const status = document.getElementById('budgetStatus');
            
            bar.style.width = pct + "%";
            if(pct > 100) { bar.style.background = "var(--danger)"; status.innerText = "Over Budget"; status.style.color = "var(--danger)"; }
            else if(pct > 80) { bar.style.background = "orange"; status.innerText = "Tight"; status.style.color = "orange"; }
            else { bar.style.background = "var(--gold)"; status.innerText = "Safe"; status.style.color = "var(--gold)"; }
        },
        convertCurrency: () => {
            const amount = document.getElementById('inrAmount').value;
            const rates = { 'USD': 0.012, 'EUR': 0.011, 'AED': 0.044 };
            const target = document.getElementById('targetCurrency').value;
            document.getElementById('conversionResult').innerText = (amount * rates[target]).toFixed(2) + " " + target;
        },
        saveHistory: (plan) => {
            let history = JSON.parse(localStorage.getItem('vplan_history') || "[]");
            history.unshift({ dest: plan.dest, date: new Date().toLocaleDateString(), cost: plan.total });
            if(history.length > 5) history.pop();
            localStorage.setItem('vplan_history', JSON.stringify(history));
            UI.loadHistory();
        },
        loadHistory: () => {
            const list = document.getElementById('historyList');
            const history = JSON.parse(localStorage.getItem('vplan_history') || "[]");
            if(history.length === 0) return;
            list.innerHTML = history.map(h => 
                `<div class="history-item" onclick="UI.showToast('Loading past plan...')">
                    <span>${h.dest}</span> <span style="color:var(--gold)">${formatINR(h.cost)}</span>
                </div>`
            ).join('');
        },
        runOptimization: async () => {
            const btn = document.getElementById('optimizeBtn');
            btn.innerText = "Analyzing..."; btn.disabled = true;
            const data = await Backend.optimize(currentPlan.total);
            const col = document.getElementById('optColumn');
            
            col.innerHTML = `
                <div class="optimization-result">
                    <strong style="color:#fff"><i class="fa-solid fa-bolt"></i> AI Optimized</strong>
                    <ul class="opt-list" style="margin-top:10px; padding:0">
                        ${data.tips.map(t => `<li><strong>${t.t}</strong><br><span style="color:var(--success-text)">Save ${formatINR(t.a)}</span></li>`).join('')}
                    </ul>
                    <div style="text-align:center; margin-top:10px; font-weight:bold; color:var(--gold)">Total Savings: ${formatINR(data.savings)}</div>
                </div>
            `;
            btn.innerText = "Optimization Applied";
            currentPlan.total -= data.savings;
            UI.renderResults(); 
        },
        renderResults: () => {
            // Update Map & Hero
            const mapUrl = `https://maps.google.com/maps?q=${encodeURIComponent(currentPlan.dest)}&t=&z=11&ie=UTF8&iwloc=&output=embed`;
            document.getElementById('mapFrame').src = mapUrl;
            document.getElementById('heroTitle').innerText = `Trip to ${currentPlan.dest}`;
            document.getElementById('heroSub').innerText = `${currentPlan.days} Days ‚Ä¢ ${formatINR(currentPlan.total)}`;
            document.getElementById('weatherBadge').style.display = 'flex';
            
            // Update Style Badge
            const styleBadge = document.getElementById('styleBadge');
            styleBadge.innerText = currentPlan.style.charAt(0).toUpperCase() + currentPlan.style.slice(1);

            // Grids
            const grid = document.getElementById('dealGrid');
            grid.innerHTML = `
                <div class="deal"><div style="font-size:12px;color:#888">Flight</div><div class="price">${formatINR(currentPlan.flightPrice)}</div></div>
                <div class="deal"><div style="font-size:12px;color:#888">Hotel Total</div><div class="price">${formatINR(currentPlan.hotelPrice * currentPlan.days)}</div></div>
                <div class="deal"><div style="font-size:12px;color:#888">Daily Costs</div><div class="price">${formatINR(currentPlan.foodCost)}</div></div>
                <div class="deal" style="border-color:var(--gold)"><div style="font-size:12px;color:var(--gold)">Total</div><div class="price">${formatINR(currentPlan.total)}</div></div>
            `;

            // Itinerary
            document.getElementById('itineraryEl').innerHTML = currentPlan.itinerary.map(i => `<div class="day"><div>Day ${i.day}: <strong>${i.act1}</strong></div><div style="font-size:12px;color:#888">${i.act2}</div></div>`).join('');
            
            // Packing List
            document.getElementById('packingEl').innerHTML = currentPlan.pack.map(p => `<div class="pack-item" style="display:inline-block; font-size:12px; padding:4px 10px; background:rgba(255,255,255,0.05); margin:2px; border-radius:12px; cursor:pointer;" onclick="this.style.opacity='0.5'"><i class="fa-solid fa-check"></i> ${p}</div>`).join('');

            // Display Logic
            ['resultCard', 'itineraryCard', 'packingCard', 'chartCard', 'optColumn'].forEach(id => document.getElementById(id).style.display = 'block');
            document.getElementById('optPlaceholder').style.display = 'none';
            document.getElementById('optimizeBtn').style.display = 'inline-block';
            
            UI.updateBudgetBar();
            UI.renderChart();
            UI.saveHistory(currentPlan);
        },
        renderChart: () => {
            const ctx = document.getElementById('pie').getContext('2d');
            if(chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Flight','Hotel','Food'],
                    datasets: [{ data: [currentPlan.flightPrice, currentPlan.hotelPrice*currentPlan.days, currentPlan.foodCost], backgroundColor: ['#d4b55a','#66bb6a','#ef5350'], borderWidth:0 }]
                },
                options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, animation:{duration:800} }
            });
        }
    };

    // --- EVENTS ---
    document.getElementById('planBtn').addEventListener('click', async () => {
        const inputs = {
            origin: document.getElementById('origin').value,
            dest: document.getElementById('destination').value,
            start: document.getElementById('start').value,
            end: document.getElementById('end').value,
            budget: Number(document.getElementById('budget').value),
            style: document.getElementById('travelStyle').value,
            interests: document.getElementById('interests').value
        };
        if(!inputs.start || !inputs.end) { UI.showToast("Please select dates!"); return; }
        
        document.getElementById('btnText').innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
        currentPlan = await Backend.generatePlan(inputs);
        UI.renderResults();
        document.getElementById('btnText').innerText = 'Generate Plan';
    });

    document.getElementById('clearBtn').onclick = () => location.reload();

    // Chat Logic
    const chatBody = document.getElementById('chatBody');
    const chatInput = document.getElementById('chatInput');
    document.getElementById('aiFab').onclick = () => { document.getElementById('chatWindow').style.display = 'flex'; document.getElementById('aiFab').style.display='none'; };
    document.getElementById('closeChat').onclick = () => { document.getElementById('chatWindow').style.display = 'none'; document.getElementById('aiFab').style.display='flex'; };
    document.getElementById('sendChat').onclick = sendMsg;
    chatInput.addEventListener('keypress', (e) => e.key === 'Enter' && sendMsg());

    async function sendMsg() {
        const txt = chatInput.value.trim(); if(!txt) return;
        chatBody.innerHTML += `<div class="msg user">${txt}</div>`; chatInput.value = ''; chatBody.scrollTop = chatBody.scrollHeight;
        const reply = await Backend.chat(txt, currentPlan);
        chatBody.innerHTML += `<div class="msg ai">${reply}</div>`; chatBody.scrollTop = chatBody.scrollHeight;
    }

    // Init
    UI.loadHistory();
    const d = new Date(); document.getElementById('start').valueAsDate = d; d.setDate(d.getDate() + 3); document.getElementById('end').valueAsDate = d;
  </script>
</body>
</html>